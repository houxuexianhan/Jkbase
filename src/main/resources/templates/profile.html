<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>AdminLTE 2 | User Profile</title>
  <!-- Tell the browser to be responsive to screen width -->
  <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
</head>
<body >
<div class="content-wrapper">
	<div id="profile_dd" class="easyui-dialog" title="请选择单位" style="width:400px;height:200px;"
        data-options="iconCls:'icon-save',resizable:true,modal:true,closed:true">
   		<div id="tree"></div>     
	</div>
    <!-- Content Header (Page header) -->
    <section class="content-header">
      <h1>个人中心</h1>
      <ol class="breadcrumb">
        <li><a href="#"><i class="fa fa-dashboard"></i>主页</a></li>
        <li class="active">个人中心</li>
      </ol>
    </section>
    <!-- Main content -->
    <section class="content">

      <div class="row">
        <div class="col-md-3">

          <!-- Profile Image -->
          <div class="box box-primary">
            <div class="box-body box-profile">
 <div class="" id="crop-avatar">
    <!-- Current avatar -->
	<div class="avatar-view" title="点击修改头像">
   <img class="profile-user-img img-responsive img-circle userHeadPhoto"  alt="User profile picture" 
    src="/dist/img/user1-128x128.jpg">
   </div>

  <!-- Cropping modal -->
  <div class="modal fade" id="avatar-modal" aria-hidden="true" aria-labelledby="avatar-modal-label" role="dialog" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <form class="avatar-form" action="profile_imgCut.do" enctype="multipart/form-data" method="post" accept="image/*">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h4 class="modal-title" id="avatar-modal-label">修改头像</h4>
          </div>
          <div class="modal-body">
            <div class="avatar-body">

              <!-- Upload image and data -->
              <div class="avatar-upload">
                <input type="hidden" class="avatar-src" name="avatar_src">
                <input type="hidden" class="avatar-data" name="avatar_data">
                <label for="avatarInput" class="btn btn-primary">选择图片</label>
                <input type="file" class="avatar-input" id="avatarInput" name="avatar_file" style="display: none;" accept="image/*">
              </div>

              <!-- Crop and preview -->
              <div class="row">
                <div class="col-md-9">
                  <div class="avatar-wrapper"></div>
                </div>
                <div class="col-md-3">
                  <div class="avatar-preview preview-lg"></div>
                  <div class="avatar-preview preview-md"></div>
                  <div class="avatar-preview preview-sm"></div>
                </div>
              </div>

              <div class="row avatar-btns">
                <div class="col-md-9">
                  <!-- <div class="btn-group">
                    <button type="button" class="btn btn-primary" data-method="rotate" data-option="-90" title="Rotate -90 degrees">Rotate Left</button>
                    <button type="button" class="btn btn-primary" data-method="rotate" data-option="-15">-15deg</button>
                    <button type="button" class="btn btn-primary" data-method="rotate" data-option="-30">-30deg</button>
                    <button type="button" class="btn btn-primary" data-method="rotate" data-option="-45">-45deg</button>
                  </div>
                  <div class="btn-group">
                    <button type="button" class="btn btn-primary" data-method="rotate" data-option="90" title="Rotate 90 degrees">Rotate Right</button>
                    <button type="button" class="btn btn-primary" data-method="rotate" data-option="15">15deg</button>
                    <button type="button" class="btn btn-primary" data-method="rotate" data-option="30">30deg</button>
                    <button type="button" class="btn btn-primary" data-method="rotate" data-option="45">45deg</button>
                  </div> -->
                </div>
                <div class="col-md-3">
                  <button type="submit" class="btn btn-primary btn-block avatar-save">确认修改</button>
                </div>
              </div>
            </div>
          </div>
          <!-- <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div> -->
        </form>
      </div>
    </div>
  </div><!-- /.modal -->

  <!-- Loading state -->
  <div class="loading" aria-label="Loading" role="img" tabindex="-1"></div>
</div>           	
              <h3 class="profile-username text-center"><span class="userNameSpan">${user.uCname}</span></h3>

              <p class="text-muted text-center"><!-- 软件工程师 --></p>
				<!-- 
              <ul class="list-group list-group-unbordered">
                <li class="list-group-item">
                  <b>粉丝</b> <a class="pull-right">1,322</a>
                </li>
                <li class="list-group-item">
                  <b>关注</b> <a class="pull-right">543</a>
                </li>
                <li class="list-group-item">
                  <b>好友</b> <a class="pull-right">13,287</a>
                </li>
              </ul> -->

              <!-- <a href="#" class="btn btn-primary btn-block"><b>Follow</b></a> -->
            </div>
            <!-- /.box-body -->
          </div>
          <!-- /.box -->

          <!-- About Me Box -->
          <div class="box box-primary">
            <div class="box-header with-border">
              <h3 class="box-title">介绍</h3>
            </div>
            <!-- /.box-header -->
            <div class="box-body">
              <strong><i class="fa fa-book margin-r-5"></i> 教育经历</strong>

              <p class="text-muted">
                ***大学
              </p>

              <hr>

              <strong><i class="fa fa-map-marker margin-r-5"></i> 现居住地</strong>

              <p class="text-muted">海南</p>

              <hr>

              <!-- <strong><i class="fa fa-pencil margin-r-5"></i> 技能</strong>

              <p>
                <span class="label label-danger">UI Design</span>
                <span class="label label-success">Coding</span>
                <span class="label label-info">Javascript</span>
                <span class="label label-warning">PHP</span>
                <span class="label label-primary">Node.js</span>
              </p> 

              <hr>
				-->
              <strong><i class="fa fa-file-text-o margin-r-5"></i> 签名</strong>

              <p>天行健，君子以自强不息。地势坤，君子以厚德载物。</p>
            </div>
            <!-- /.box-body -->
          </div>
          <!-- /.box -->
        </div>
        <!-- /.col -->
        <div class="col-md-9">
          <div class="nav-tabs-custom">
            <ul class="nav nav-tabs">
            <!--   <li ><a href="#activity" data-toggle="tab">Activity</a></li>
              <li><a href="#timeline" data-toggle="tab">Timeline</a></li> -->
              <li class="active"><a href="#settings" data-toggle="tab">修改资料</a></li>
              <li><a href="#updatePassword" data-toggle="tab">修改密码</a></li>
            </ul>
            <div class="tab-content">
              <div class="active tab-pane" id="settings">
                <form  id="form_info" action="profile_updateInfo.do" method="post">
		  		  <input name="uCompanyid" type="hidden" value="${user.uCompanyid}"/>
		  		  <div class="form-group">
                    <label class="control-label">账号（登录名）</label>

                    <div class="controls">
                      <input type="text" class="form-control" disabled="disabled" value="${user.uLoginname}">
                    </div>
                  </div>
                  <div class="form-group">
                    <label class="control-label">用户姓名</label>
                    <div class="controls">
                      <input type="text" class="form-control" name="uCname" value="${user.uCname}">
                    </div>
                  </div>
                  <div class="form-group">
                    <label class="control-label">所属单位部门
                    	<a href="#" id="selectCompany" class="dt-button" onclick="$('#profile_dd').dialog('open');">选择单位
							<i class="fa fa-caret-down" aria-hidden="true"></i></a>
                    </label>
                    <div class="controls">
                      <input id="u_CompanyName"  type="text" placeholder="请选择单位部门" class="form-control" readonly="readonly" value="${user.uCompanyname}">
                    </div>
                  </div>
                  <div class="form-group">
                    <label class="control-label">手机号</label>
                    <div class="controls">
                      <input name="uMobileno" type="number" class="form-control" value="${user.uMobileno}">
                    </div>
                  </div>
                 <!--  
                  <div class="form-group">
                    <div class="col-sm-offset-2 col-sm-10">
                      <div class="checkbox">
                        <label>
                          <input type="checkbox"> I agree to the <a href="#">terms and conditions</a>
                        </label>
                      </div>
                    </div>
                  </div> -->
                  <div class="form-group">
                  	<div class="controls" style="margin-left: 150px;">
                      <button type="button" onclick="submitInfoForm()" class="btn btn-danger" >提交</button>
                    </div>
                  </div>
                </form>
              </div>
              <!-- /.tab-pane -->
              <div class="tab-pane" id="updatePassword">
                <form  id="form_updatePwd" action="profile_changePwd.do" method="post">
                  <div class="form-group">
                    <label class="control-label">原始密码</label>
                    <div class="controls">
                      <input name="pwdOld" type="password" class="form-control" >
                    </div>
                  </div>
                   <div class="form-group">
                    <label class="control-label">新密码</label>
                    <div class="controls">
                      <input name="pwdNew" type="password" class="form-control" >
                    </div>
                  </div>
                   <div class="form-group">
                    <label class="control-label">再次新密码</label>
                    <div class="controls">
                      <input name="pwdRenew" type="password" class="form-control" >
                    </div>
                  </div>
                  <div class="form-group">
                  	<div class="controls" style="margin-left: 150px;">
                      <button type="submit"  class="btn btn-danger">提交</button>
                    </div>
                  </div>
                </form>
              </div>
            </div>
            <!-- /.tab-content -->
          </div>
          <!-- /.nav-tabs-custom -->
        </div>
        <!-- /.col -->
      </div>
      <!-- /.row -->

    </section>
    <!-- /.content -->
  </div>
  
</body>
<!-- cropper  -->
<script src="/plugins/cropper/cropper.min.js"></script>
<script src="/plugins/cropper/crop-avatar/js/main.js"></script>
<script type="text/javascript">
$(function(){
	$.parser.parse();
	//初始化treeview 数据
	$.post('SysMgr/company_getTreeSelect.do',{},function(data){
		 var data = eval('(' + data + ')');
		 if(data.success){
			 $('#profile_dd #tree').treeview({
				data: data.data,	
				showTags:false,
				//showCheckbox:true,
				onNodeSelected: function(event, data) {
					var tags = data.tags;
					$('#form_info input[name=uCompanyid]').val(tags[0]);
					$('#form_info #u_CompanyName').val(data.text);
					$('#profile_dd').dialog('close');
				}
			});
		 }else{
			 alert(data.info);
		 }
	}); 
});
function submitInfoForm(){
	$('#form_info').form('submit',{
		success:function(data){
			  var data = eval('(' + data + ')');
			  alert(data.info);
			  if(data.success){
				  $('span.userNameSpan').text(data.data);
			  }
		  }
	});
}
function submitPwdForm(){
	$('#form_updatePwd').form('submit',{
		  onSubmit: function(param){
			  var pwdOld = $('#form_updatePwd #pwdOld').val();
			  if($.trim(pwdOld)==''){
				  alert('原始密码不能为空！')
				  $('#form_updatePwd #pwdOld').focus();
				  return false;
			  }
			  var pwdNew = $('#form_updatePwd #pwdNew').val();
			  if($.trim(pwdNew)==''){
				  alert('新密码不能为空！')
				  $('#form_updatePwd #pwdNew').focus();
				  return false;
			  }
			  var pwdRenew =  $('#form_updatePwd #pwdRenew').val();
			  if($.trim(pwdRenew)==''){
				  alert('重复密码不能为空！')
				  $('#form_updatePwd #pwdRenew').focus();
				  return false;
			  }
			  if(pwdNew!=pwdRenew){
				  alert('两次输入密码不一致！')
				  $('#form_updatePwd #pwdRenew').focus();
				  return false;
			  }
			  if(pwdOld==pwdNew){
				  alert('新密码不能和原始密码一致！')
				  $('#form_updatePwd #pwdNew').focus();
				  return false;
			  }
			  /*
			  var key = $('#updatePassword #KEY').val();
			  key = CryptoJS.enc.Utf8.parse(key);  
			  param.pwdOld =  CryptoJS.AES.encrypt(CryptoJS.enc.Utf8.parse($.trim(pwdOld)), key, {mode:CryptoJS.mode.ECB,padding: CryptoJS.pad.Pkcs7});
			  param.pwdRenew =  CryptoJS.AES.encrypt(CryptoJS.enc.Utf8.parse($.trim(pwdRenew)), key, {mode:CryptoJS.mode.ECB,padding: CryptoJS.pad.Pkcs7});
			  param.pwdNew =  CryptoJS.AES.encrypt(CryptoJS.enc.Utf8.parse($.trim(pwdNew)), key, {mode:CryptoJS.mode.ECB,padding: CryptoJS.pad.Pkcs7});
			  */
		  },
		  success:function(data){
			  var data = eval('(' + data + ')');
			  alert(data.info);
			  if (data.success){
				  $('#form_updatePwd').form('reset');
		      }else{
		    	  if(data.data=='timeout'){
		    		  window.location.href = '${request.contextPath}/';
		    	  }else if(data.data==''){
		    	  }else{//key
		    		  //$('#updatePassword #KEY').val(data.data);
		    	  }
		      }
		  }
	}) ;
}
</script>
</html>
